<!-- azioni.html - CORRETTO con URL reale -->
<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Azioni PG D&D 5e</title>
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <style>
        body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;margin:20px;background:#f5f5f5;color:#333}
        .container{max-width:1000px;margin:0 auto;background:#fff;padding:20px;border-radius:10px;box-shadow:0 0 20px rgba(0,0,0,0.1)}
        h1{text-align:center;color:#8B4513;font-size:2.2em;margin-bottom:20px}
        .azioni-container{display:grid;grid-template-columns:repeat(auto-fit,minmax(400px,1fr));gap:20px}
        .azione-gruppo{background:#fafafa;border:2px solid #ddd;border-radius:10px;overflow:hidden}
        .azione-gruppo h2{background:linear-gradient(135deg,#8B4513,#A0522D);color:white;padding:15px;margin:0;font-size:1.4em;text-align:center}
        .lista-azioni{max-height:500px;overflow-y:auto;padding:10px}
        .lista-azioni li{list-style:none;padding:12px;margin:8px 0;border-left:4px solid #8B4513;background:#fff;border-radius:5px;box-shadow:0 2px 5px rgba(0,0,0,0.1)}
        .nome-azione{font-weight:bold;font-size:1.1em;color:#2c3e50;margin-bottom:5px}
        .dettagli{font-size:0.95em;color:#555;line-height:1.4}
        .dettagli span{display:inline-block;margin-right:15px;margin-bottom:5px;background:#ecf0f1;padding:3px 8px;border-radius:12px;font-size:0.9em}
        nav{text-align:center;margin:30px 0}
        nav a{display:inline-block;padding:12px 25px;background:#8B4513;color:white;text-decoration:none;border-radius:25px;font-weight:bold;box-shadow:0 4px 10px rgba(139,69,19,0.3)}
        nav a:hover{background:#A0522D;transform:translateY(-2px)}
        .loading{text-align:center;padding:40px;font-size:1.2em;color:#8B4513}
        @media (max-width:768px){.azioni-container{grid-template-columns:1fr}}
    </style>
</head>
<body>
    <div class="container">
        <h1>üó°Ô∏è Azioni & Incantesimi</h1>
        <div id="azioni" class="azioni-container">
            <div class="loading">Caricamento azioni dal tuo Google Sheet...</div>
        </div>
        <nav>
            <a href="index.html">üè† Scheda Principale</a>
        </nav>
    </div>

    <script>
        // URL CORRETTO - COPIA ESATTAMENTE QUESTO
        const API_URL = 'https://script.google.com/macros/s/AKfycbwgEpUakdFSPITj2Xq4LZ0hIV3huVZz08Pw_fHxU6YPZ1H1QWGZbv25iR45aDKAtWOX1Q/exec';
        
        async function caricaAzioni() {
            try {
                console.log('Caricando da:', API_URL);
                const response = await fetch(API_URL);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const text = await response.text();
                console.log('Risposta API:', text.substring(0, 200));
                
                let azioni;
                try {
                    azioni = JSON.parse(text);
                } catch (e) {
                    throw new Error('JSON non valido. API restituisce: ' + text.substring(0, 100));
                }
                
                if (!Array.isArray(azioni) || azioni.length === 0) {
                    document.getElementById('azioni').innerHTML = 
                        '<div style="text-align:center;padding:40px;color:#f39c12">‚ö†Ô∏è Nessuna azione trovata nel Sheet. Aggiungi dati!</div>';
                    return;
                }
                
                const gruppi = {
                    '1 action': [],
                    'Bonus Action': [],
                    'Reazione': [],
                    'Altro': []
                };
                
                azioni.forEach(azione => {
                    const castingTime = azione['casting time'] || 'Altro';
                    const gruppo = gruppi[castingTime] || gruppi['Altro'];
                    
                    let dettagliHTML = '';
                    const props = { ...azione };
                    delete props.nome;
                    delete props['casting time'];
                    
                    for (let chiave in props) {
                        if (props[chiave]) {
                            dettagliHTML += `<span>${chiave}: ${props[chiave]}</span>`;
                        }
                    }
                    
                    gruppo.push(`
                        <li>
                            <div class="nome-azione">${azione.nome || 'Senza nome'}</div>
                            <div class="dettagli">${dettagliHTML}</div>
                        </li>
                    `);
                });
                
                const container = document.getElementById('azioni');
                container.innerHTML = '';
                
                Object.entries(gruppi).forEach(([tipo, lista]) => {
                    if (lista.length > 0) {
                        container.innerHTML += `
                            <div class="azione-gruppo">
                                <h2>${tipo.replace('1 action', '‚öîÔ∏è 1 Azione').replace('Bonus Action', '‚≠ê Azione Bonus').replace('Reazione', 'üõ°Ô∏è Reazione').replace('Altro', 'üìã Altro')}</h2>
                                <ul class="lista-azioni">${lista.join('')}</ul>
                            </div>
                        `;
                    }
                });
                
            } catch (error) {
                console.error('Errore completo:', error);
                document.getElementById('azioni').innerHTML = 
                    `<div style="text-align:center;padding:40px;color:#e74c3c;font-family:monospace">
                        ‚ùå Errore: ${error.message}<br>
                        <small>Controlla Console (F12) per dettagli</small>
                    </div>`;
            }
        }
        
        window.addEventListener('load', caricaAzioni);
    </script>
</body>
</html>
