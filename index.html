<!DOCTYPE html>
<html>
<head>
  <title>Unveiler Sheet Editor</title>
  <style>
    body { margin: 0; font-family: Arial; }
    .band { height: 200px; border: 1px solid #ccc; padding: 20px; overflow-x: auto; white-space: nowrap; box-sizing: border-box; }
    .band1 { background: #f0f8ff; }
    .band2 { background: #fff0f5; }
    .band3 { background: #f5f5f5; height: 200px; } /* Vuota */
    .cell { display: inline-block; min-width: 100px; padding: 10px; margin: 2px; border: 1px solid #ddd; background: white; }
    .editable { border-color: #007bff; }
    .editable:focus { outline: none; box-shadow: 0 0 5px #007bff; }
    .buttons { position: fixed; top: 10px; right: 10px; z-index: 10; }
    button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; cursor: pointer; }
    button:hover { background: #0056b3; }
    button:disabled { background: #ccc; cursor: not-allowed; }
  </style>
</head>
<body>
  <div class="buttons">
    <button id="loadBtn">Carica dal Sheet</button>
    <button id="saveBtn">Salva su Sheet</button>
  </div>
  
  <div id="band1" class="band band1">Riga 1: Carica dati per visualizzare</div>
  <div id="band2" class="band band2">Riga 2: Carica dati per visualizzare</div>
  <div id="band3" class="band band3">Terza banda (vuota - da definire)</div>

  <script>
    const WEB_APP_URL = 'INSERISCI_TUO_URL_EXEC_QUI'; // Es. https://script.google.com/macros/s/TUO_ID/exec
    
    async function loadData() {
      document.getElementById('loadBtn').disabled = true;
      try {
        const res = await fetch(`${WEB_APP_URL}?action=read`);
        const data = await res.json();
        if (data.success) {
          renderBand('band1', data.row1);
          renderBand('band2', data.row2);
        } else {
          alert('Errore: ' + data.error);
        }
      } catch (err) {
        alert('Errore caricamento: ' + err);
      }
      document.getElementById('loadBtn').disabled = false;
    }
    
    async function saveData() {
      document.getElementById('saveBtn').disabled = true;
      try {
        const row1 = Array.from(document.querySelectorAll('#band1 .cell input')).map(el => el.value);
        const row2 = Array.from(document.querySelectorAll('#band2 .cell input')).map(el => el.value);
        const res = await fetch(WEB_APP_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
          body: `action=write&row1=${encodeURIComponent(JSON.stringify(row1))}&row2=${encodeURIComponent(JSON.stringify(row2))}`
        });
        const data = await res.json();
        if (data.success) {
          alert('Salvato con successo!');
        } else {
          alert('Errore: ' + data.error);
        }
      } catch (err) {
        alert('Errore salvataggio: ' + err);
      }
      document.getElementById('saveBtn').disabled = false;
    }
    
    function renderBand(bandId, rowData) {
      const band = document.getElementById(bandId);
      band.innerHTML = rowData.map((cell, i) => 
        `<span class="cell editable"><input type="text" value="${cell || ''}" data-col="${i}"></span>`
      ).join('');
    }
    
    document.getElementById('loadBtn').addEventListener('click', loadData);
    document.getElementById('saveBtn').addEventListener('click', saveData);
  </script>
</body>
</html>
